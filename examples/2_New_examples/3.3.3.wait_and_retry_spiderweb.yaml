abstract: |
  This DAG models a retry-heavy “spiderweb” structure: a root unstable PythonTask branches into three two-level sub-branches. After the branches complete, the DAG merges them into a final unstable PythonTask with its own retry policy. The multi-branch, multi-tier layout stresses retry propagation, concurrency handling, and orchestrator performance under complex retry graphs.

dag:
  name: "wait_and_retry_spiderweb"
  tasks:

    # ROOT
    - task_id: "root"
      type: "PythonTask"
      params:
        script: |
          import random, sys
          if random.random() < .5: sys.exit(1)
          print("Root OK")
      retries: 3
      retry_delay: 2
      dependencies: []

    # BRANCH A
    - task_id: "a1"
      type: "BashTask"
      params:
        command: "if [ $((RANDOM % 2)) -eq 0 ]; then exit 1; fi; echo A1"
      retries: 2
      retry_delay: 1
      dependencies: ["root"]

    - task_id: "a2"
      type: "PythonTask"
      params:
        script: |
          import random, sys
          if random.random() < .4: sys.exit(1)
          print("A2 OK")
      retries: 3
      retry_delay: 1
      dependencies: ["a1"]

    # BRANCH B
    - task_id: "b1"
      type: "PythonTask"
      params:
        script: |
          import random, sys
          if random.random() < .6: sys.exit(1)
          print("B1 OK")
      retries: 4
      retry_delay: 1
      dependencies: ["root"]

    - task_id: "b2"
      type: "BashTask"
      params:
        command: "if [ $((RANDOM % 3)) -eq 0 ]; then exit 1; fi; echo B2"
      retries: 2
      retry_delay: 2
      dependencies: ["b1"]

    # BRANCH C
    - task_id: "c1"
      type: "BashTask"
      params:
        command: "if [ $((RANDOM % 2)) -eq 0 ]; then exit 1; fi; echo C1"
      retries: 3
      retry_delay: 1
      dependencies: ["root"]

    - task_id: "c2"
      type: "PythonTask"
      params:
        script: |
          import random, sys
          if random.random() < .5: sys.exit(1)
          print("C2 OK")
      retries: 3
      retry_delay: 1
      dependencies: ["c1"]

    # MERGE
    - task_id: "merge"
      type: "PrintTask"
      params:
        message: "Branches merged successfully"
      dependencies: ["a2", "b2", "c2"]

    # FINAL UNSTABLE TASK
    - task_id: "final_unstable"
      type: "PythonTask"
      params:
        script: |
          import random, sys
          if random.random() < .4: sys.exit(1)
          print("Final task OK")
      retries: 3
      retry_delay: 2
      dependencies: ["merge"]

    # END
    - task_id: "done"
      type: "PrintTask"
      params:
        message: "Spiderweb retry pipeline fully completed."
      dependencies: ["final_unstable"]
